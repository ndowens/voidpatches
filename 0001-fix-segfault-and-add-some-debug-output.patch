From 72be355284da9ec189cad7bc0c8a00d958529115 Mon Sep 17 00:00:00 2001
From: Hannes Franke <hannes.franke@udo.edu>
Date: Fri, 21 Nov 2014 01:48:45 +0100
Subject: [PATCH 1/3] fix segfault and add some debug output

---
 unpaper.c | 13 ++++++++++++-
 1 file changed, 12 insertions(+), 1 deletion(-)

diff --git unpaper.c unpaper.c
index d3d91ad..f8767e0 100644
--- unpaper.c
+++ unpaper.c
@@ -980,6 +980,9 @@ int main(int argc, char* argv[]) {
             } else {
                 inputFileNames[i] = argv[optind++];
             }
+	    if (verbose >= VERBOSE_DEBUG) {
+		printf("added input file %s\n", inputFileNames[i]);
+	    }
 
             if ( inputFileNames[i] != NULL ) {
                 struct stat statBuf;
@@ -996,7 +999,11 @@ int main(int argc, char* argv[]) {
         }
         if ( inputWildcard )
             optind++;
-
+	
+	if(optind >= argc) { // see any one of the last two optind++ has pushed over the array
+		errOutput("not enough output files given.");
+		return -1;
+	}
         bool outputWildcard = multisheets && (strchr(argv[optind], '%') != NULL);
         for(int i = 0; i < outputCount; i++) {
             if ( outputWildcard ) {
@@ -1008,6 +1015,10 @@ int main(int argc, char* argv[]) {
             } else {
                 outputFileNames[i] = argv[optind++];
             }
+	    if (verbose >= VERBOSE_DEBUG) {
+		printf("added output file %s\n", outputFileNames[i]);
+	    }
+	    
 
             if ( ! overwrite ) {
                 struct stat statbuf;
-- 
2.20.1

